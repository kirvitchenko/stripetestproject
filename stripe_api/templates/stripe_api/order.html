<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Order {{ order.id }}</title>
    <script src="https://js.stripe.com/v3/"></script>  <!-- ← ДОБАВЬ ЭТУ СТРОЧКУ -->
</head>
<body>
    <h1>Order #{{ order.id }}</h1>

    {% for order_item in order.order_items.all %}
        <div>
            <h3>{{ order_item.item.name }}</h3>
            <p>{{ order_item.item.description }}</p>
            <p>Price: ${{ order_item.item.price }} x {{ order_item.quantity }}</p>
        </div>
    {% endfor %}

    {% if order.discount %}
        <p><strong>Скидка: {{ order.discount.discount_value }}%!</strong></p>
    {% endif %}
    {% if order.tax %}
        <p><strong>Налог: {{ order.tax.tax_rate }}%!</strong></p>
    {% endif %}
    <p><strong>Итого: ${{ order.total_price }}</strong></p>


    <button id="buy-button">Buy All</button>

    <script>
        // Инициализация Stripe с публичным ключом
        const stripe = Stripe('{{ STRIPE_PUBLIC_KEY }}');  <!-- ← ДОБАВЬ ЭТО -->
        const buyButton = document.getElementById('buy-button');

        buyButton.addEventListener('click', function() {
            fetch('/buy/order/{{ order.id }}/', {method: 'GET'})
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(session => {
                return stripe.redirectToCheckout({ sessionId: session.id });
            })
            .then(result => {
                if (result.error) {
                    alert(result.error.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Payment failed: ' + error.message);
            });
        });
    </script>
</body>
</html>